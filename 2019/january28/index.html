<!DOCTYPE html>
<html lang="zh-cn">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Alston.Yang">
  <meta name="description" content="Alston的个人博客，走过路过可以错过，反正我的文笔烂得跟小学生一样">
  <meta name="keywords" content="Alston 个人博客">
  
  <link rel="prev" href="https://alston.top/2019/january14/" />
  
  <link rel="canonical" href="https://alston.top/2019/january28/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">
  <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           EXCEL高级排序和匹配方法 | Alston&#39;s Blog
       
  </title>
  <meta name="title" content="EXCEL高级排序和匹配方法 | Alston&#39;s Blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https://alston.top"
    },
    "articleSection" : "posts",
    "name" : "EXCEL高级排序和匹配方法",
    "headline" : "EXCEL高级排序和匹配方法",
    "description" : "Summary of this article",
    "inLanguage" : "zh-cn",
    "author" : "Alston.Yang",
    "creator" : "Alston.Yang",
    "publisher": "Alston.Yang",
    "accountablePerson" : "Alston.Yang",
    "copyrightHolder" : "Alston.Yang",
    "copyrightYear" : "2019",
    "datePublished": "2019-01-28 21:27:25 &#43;0800 CST",
    "dateModified" : "2019-01-28 21:27:25 &#43;0800 CST",
    "url" : "https://alston.top/2019/january28/",
    "wordCount" : "2090",
    "keywords" : [ "办公","EXCEL技术", "Alston&#39;s Blog"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://alston.top">Alston&#39;s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://alston.top">Alston&#39;s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">EXCEL高级排序和匹配方法</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://alston.top" rel="author">Alston.Yang</a> with ♥ 
                <span class="post-time">
                on <time datetime=2019-01-28 itemprop="datePublished">January 28, 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://alston.top/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/"> 编程·技术 </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          

<p>最近有一个任务涉及到比较复杂的EXCEL操作，虽然对EXCEL函数不是很熟悉，但是又想用单个公式解决，所以花了很长时间才解决。成就感十足，特此记录，免得以后忘了。</p>

<h2 id="任务描述">任务描述</h2>

<p>原始任务更复杂一点，出于隐私和简化目的，用一个简单的例子来代替。如图：<br />
<figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://s2.ax1x.com/2019/01/28/kMiwtI.png" alt="EXCEL任务" class="lazyload"><figcaption class="image-caption">EXCEL任务</figcaption></figure><br />
左边每一行有惟一的学生ID、所在班别、评判标准、语数英成绩；右边每一行一样，包含了所有的学生信息。现在想根据每个学生的评判标准计算出该学生在班里的排名，比如学生ID为1的学生，计算他的语文成绩在甲班中的排名。</p>

<h2 id="需要用到的函数">需要用到的函数</h2>

<h3 id="rank">rank</h3>

<p>EXCEL中排序最简单的函数就是用<code>rank</code>函数了，用法是<code>=rank(num, array,order)</code>，其中<code>num</code>是要排名的数值，<code>array</code>是要排名的序列，<code>order</code>表示升、降序，默认为0（降序），要升序则设为1。这里需要注意是<code>num</code>并且在<code>array</code>中，否则结果为<code>#N/A</code>。</p>

<p>但是在遇到条件排序时用<code>rank</code>就不够了，这时候可以用<code>sumproduct</code>进行排序。</p>

<h3 id="sumproduct">sumproduct</h3>

<p><code>sumproduct</code>，顾名思义，表示“乘积之和”，即数学定义中的“内积”，用法是<code>=sumproduct(array1, array2, ...)</code>，参数必须是相同维度的范围，EXCEL会计算相应位置的数字乘积，然后加总得出结果。</p>

<p><code>sumproduct</code>用法有很多，这里我们用它来进行排序，从而得到带有条件判断的排序（这里还用到了EXCEL对序列的计算特性，了解就好）。比如要求第1到第11个学生的语文成绩在各自班级中的排名，公式如下：</p>

<p><code>=sumproduct(($J$2:$J$21 = B2) * ($L$2:$L$2 &gt; D2)) + 1</code></p>

<p>上式中的<code>&gt;</code>号可以根据需求改成<code>&gt;=</code>、<code>&lt;=</code>、<code>&lt;</code>。</p>

<p>需要注意的是，很多人可能会觉得中间的乘号<code>*</code>可以改成逗号<code>,</code>，这是不对的。因为<code>($J$2:$J$21 = B2)</code>和<code>($L$2:$L$2 &gt; D2)</code>是两个逻辑序列，互相独立的两个逻辑数据之间不能进行对应位置处逻辑值相乘。</p>

<h3 id="match">match</h3>

<p><code>match</code>用于匹配指定值在指定序列中的位置，用法是<code>=match(num, array, type)</code>，其中<code>num</code>为要匹配的内容，<code>array</code>为要匹配的序列，<code>type</code>为指定的查询方式，取值为-1,0,1，定义如下：</p>

<table>
<thead>
<tr>
<th align="center">type</th>
<th align="center">说明</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">1/省略</td>
<td align="center">查找<strong>小于或等于</strong>指定内容的<strong>最大值</strong>，而且指定区域必须按<strong>升序</strong>排列</td>
</tr>

<tr>
<td align="center">0</td>
<td align="center">查找<strong>等于</strong>指定内容的<strong>第一个</strong>数值</td>
</tr>

<tr>
<td align="center">-1</td>
<td align="center">查找<strong>大于或等于</strong>指定内容的<strong>最小值</strong>，而且指定内容必须按<strong>降序</strong>排列</td>
</tr>
</tbody>
</table>

<h3 id="address">address</h3>

<p><code>address</code>用于根据指定行号和列号获得单元格地址，用法是<code>=address(row_num, column_num, [abs_num], [a1], [sheet_text])</code>。其中<code>abs_num</code>表示返回的单元格地址格式，取值为1到4，定义如下：</p>

<table>
<thead>
<tr>
<th align="center">abs_num</th>
<th align="center">说明</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">1/省略</td>
<td align="center">绝对地址，如&rdquo;$A$1&rdquo;</td>
</tr>

<tr>
<td align="center">2</td>
<td align="center">绝对行号，相对列标，如&rdquo;A$1&rdquo;</td>
</tr>

<tr>
<td align="center">3</td>
<td align="center">相对行号，绝对列标，如&rdquo;$A1&rdquo;</td>
</tr>

<tr>
<td align="center">4</td>
<td align="center">相对地址，如&rdquo;A1&rdquo;</td>
</tr>
</tbody>
</table>

<p><code>a1</code>表示返回的单元格样式，取值为1或者省略时，返回A1样式（如上表举例）；取值为0时返回R1C1样式，如<code>R[1]C[1]</code>。<br />
<code>sheet_text</code>表示表名，相当于在返回值前面加上<code>sheet_text!</code>引用。</p>

<h3 id="indirect">indirect</h3>

<p><code>indirect</code>返回由文本字符串指定的引用，用法比较简单，<code>=indirect(ref_text, a1)</code>。<br />
其中<code>ref_text</code>是要引用的文本，<code>a1</code>为单元格样式与上面定义一致。比如<code>indirect(&quot;A1&quot;)</code>则返回<code>A1</code>单元格的内容。</p>

<h2 id="解决问题">解决问题</h2>

<p>搞清楚需要用到的函数后，就可以着手解决问题了。我们的任务是根据每个学生的评判标准计算出该学生在班里的排名，比如学生ID为1的学生，计算他的语文成绩在甲班中的排名。以<code>G2</code>单元格为例：</p>

<ol>
<li>首先，要求在甲班中的排名，所以用<code>sumproduct</code>：<br />
<code>=sumproduct(($J:$J = B2)*???) + 1</code>，问号是需要动态变化的，我们想要的是每个学生对应的评判标准对应的列，比如说第一个学生的评判标准是语文，则问号对应的是<code>($L:$L &gt; D2)</code>。<br /></li>
<li>获得动态的评判标准所在列的列标：<br />

<ul>
<li>先用<code>match</code>得到对应的行、列号：<code>match(C2, $1:$1)</code><br /></li>
<li>再用<code>address</code>得到对应的行号、列标：<code>address(1, match(C2,$1:$1), 4</code>，注意这里的1是固定的，因为我们从第一行里去匹配；4可以省略也可以换成1、2、3，对结果不造成影响。<br /></li>
<li>因为我们只需要用到列标，所以用<code>left</code>取列标：<code>left(address(1,match(C2,$1:$1), 4), len(address(1,match(C2,$1:$1),4))-1)</code>，如果能确定列标只有一个字母的话，<code>len</code>那一串可以直接换成1。<br /></li>
</ul></li>
<li>最后再用<code>indirect</code>取对应单元格的内容：<code>indirect(left(address(1,match(C2,$1:$1), 4), len(address(1,match(C2,$1:$1),4))-1) &amp; &quot;:&quot; &amp; left(address(1,match(C2,$1:$1), 4), len(address(1,match(C2,$1:$1),4))-1))</code>，用这一坨代替前面的三个问号就可以了。<br />
<br /></li>
</ol>

<h2 id="后记">后记</h2>

<p>拆开后其实还是挺简单的，如果不嫌麻烦、对excel函数又比较熟悉的话，很快就可以做出来了。手工做的话，就得先按班排序，然后再把语数英三门成绩分开排序，最后再计算排名，还是比较烦琐且容易出错的。</p>

<h2 id="参考链接">参考链接</h2>

<ol>
<li><a href="https://baijiahao.baidu.com/s?id=1571397722910063&amp;wfr=spider&amp;for=pc" rel="nofollow noreferrer" target="_blank">SUMPRODUCT函数注意事项：乘号与逗号有区别</a><br /></li>
<li><a href="https://support.office.com/zh-cn/article/ADDRESS-%E5%87%BD%E6%95%B0-D0C26C0D-3991-446B-8DE4-AB46431D4F89" rel="nofollow noreferrer" target="_blank">ADDRESS函数</a><br /></li>
<li><a href="https://support.office.com/zh-cn/article/INDIRECT-%E5%87%BD%E6%95%B0-474b3a3a-8a26-4f44-b491-92b6306fa261" rel="nofollow noreferrer" target="_blank">INDIRECT函数</a><br /></li>
</ol>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Alston.Yang </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <span><a href=https://alston.top/2019/january28/>https://alston.top/2019/january28/</a></span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可，欢迎转载但需保留作者署名。
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://alston.top/tags/%E5%8A%9E%E5%85%AC/">
                    #办公</a></span>
            
            <span class="tag"><a href="https://alston.top/tags/excel%E6%8A%80%E6%9C%AF/">
                    #EXCEL技术</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://alston.top">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://alston.top/2019/january14/" class="prev" rel="prev" title="中证征信第一天"><i class="iconfont icon-left"></i>&nbsp;中证征信第一天</a>
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2019</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://alston.top">Alston.Yang</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
